<!doctype html><html lang=en class="wf-firasans-n4-active wf-active"><head><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.121.0"><title>C# Internals - Single and SingleOrDefault &#183; Moien Tajik</title>
<meta content="Moien Tajik" property="og:site_name"><meta content="C# Internals - Single and SingleOrDefault - Moien Tajik" property="og:title"><meta content="C# Internals - Single and SingleOrDefault" property="og:description"><meta content="./WrongAssumption.jpg" property="og:image"><link href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i|Roboto+Mono:300,300i,400,400i" rel=stylesheet><style media=print>.sidebar{display:none!important}.container,.content{width:100%;float:none;display:initial;margin:0 auto}.container{padding-left:1rem;padding-right:1rem}</style><link rel=stylesheet href=/css/poole.css><link rel=stylesheet href=/css/hyde.css><link rel=stylesheet href=/css/custom.css><script defer src=https://use.fontawesome.com/releases/v5.0.13/js/all.js integrity=sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe crossorigin=anonymous></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-te><div class=sidebar><div class="container text-center"><div class="sidebar-about text-center"><img src=/img/Moien%20Tajik.png alt="Moien Tajik's Image" class="img-circle headshot center">
<a href=/ class=no-decoration><h1 class=brand>Moien Tajik</h1></a><p class=lead>Principal Software Engineer</p></div><div><ul class=sidebar-nav><li><a href=/><span>Home</span></a></li><li><a href=/posts/><span>Posts</span></a></li><li><a href=/tags/><span>Tags</span></a></li></li></ul></div><p><section class="row text-center"><a href=https://twitter.com/MoienTajik><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://github.com/MoienTajik><i class="fab fa-github fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://linkedin.com/in/MoienTajik><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://stackoverflow.com/story/moientajik><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://medium.com/@MoienTajik><i class="fab fa-medium fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=mailto:moientajik@hotmail.com><i class="fas fa-at fa-lg" aria-hidden=true></i></a></section></p><p class=copyright>&copy; 2024 Moien Tajik</br><a href=https://creativecommons.org/licenses/by/4.0>All rights reserved</a></p></div><div></div></div><div class="content container"><div class=post><h1 class=postTitle>C# Internals - Single and SingleOrDefault</h1><div class="col-sm-12 col-md-12"><span class="text-left post-date meta"><i class="fas fa-calendar-alt"></i> <span class=subtitle>Publish Date: Oct 16, 2019</span><br><i class="fas fa-tags"></i>
Tags:
<a class=meta href=/tags/c>c#</a>
,
<a class=meta href=/tags/csharp>csharp</a>
,
<a class=meta href=/tags/first>first</a>
,
<a class=meta href=/tags/firstordefault>firstordefault</a>
,
<a class=meta href=/tags/internals>internals</a>
,
<a class=meta href=/tags/single>single</a>
,
<a class=meta href=/tags/singleordefault>singleordefault</a><br></span></div><hr><p>Many developers occasionally use the LINQ methods <code>First</code> and <code>FirstOrDefault</code> as substitutes for <code>Single</code> and <code>SingleOrDefault</code>. This practice stems from the belief that <code>Single</code> traverses &ldquo;all&rdquo; items in an Enumerable to find the result, whereas <code>First</code> and <code>FirstOrDefault</code> do not need to traverse the entire Enumerable, making them faster.</p><p>However, replacing <code>Single</code> with <code>First</code> is not always feasible, as these two methods serve different purposes and cannot always be interchanged. Despite their distinct functionalities, there are instances where they can be swapped.</p><p><img src=./WrongAssumption.jpg alt="Wrong Assumptions"></p><hr><p>The <code>SingleOrDefault</code> method does not always traverse &ldquo;all&rdquo; items of an Enumerable. ❌</p><p>If we call <code>Single&lt;T></code> or <code>SingleOrDefault&lt;T></code> without passing any <em>Predicate</em>, three scenarios can occur:</p><ul><li>If there are zero items, the default value of type <strong>T</strong> is returned.</li><li>If there is exactly one item, item <strong>[0]</strong> of the Enumerable is returned.</li><li>If there are more than one items, an error is thrown.</li></ul><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> TSource SingleOrDefault&lt;TSource&gt;(<span style=color:#66d9ef>this</span> IEnumerable&lt;TSource&gt; source)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (source == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> Error.ArgumentNull(nameof (source));
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (source <span style=color:#66d9ef>is</span> IList&lt;TSource&gt; sourceList)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> (sourceList.Count)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>default</span> (TSource);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sourceList[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>using</span> (IEnumerator&lt;TSource&gt; enumerator = source.GetEnumerator())
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (!enumerator.MoveNext())
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>default</span> (TSource);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>      TSource current = enumerator.Current;
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (!enumerator.MoveNext())
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> current;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>throw</span> Error.MoreThanOneElement();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p>When these methods are called with a Predicate, they traverse the Enumerable and during this process, three situations can arise:</p><ul><li>If no item matches the Predicate, the default value of <strong>T</strong> is returned.</li><li>If one item is found, the traversal continues. If another matching item is found, an <strong>error</strong> is thrown immediately. This second item could be the next one (1+) or any subsequent item (N+1).</li><li>If no additional matching items are found, the first matching item is returned.</li></ul><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> TSource SingleOrDefault&lt;TSource&gt;(
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span> IEnumerable&lt;TSource&gt; source,
</span></span><span style=display:flex><span>      Func&lt;TSource, <span style=color:#66d9ef>bool</span>&gt; predicate)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (source == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> Error.ArgumentNull(nameof (source));
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (predicate == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> Error.ArgumentNull(nameof (predicate));
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>using</span> (IEnumerator&lt;TSource&gt; enumerator = source.GetEnumerator())
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (enumerator.MoveNext())
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      TSource current = enumerator.Current;
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (predicate(current))
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (enumerator.MoveNext())
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (predicate(enumerator.Current))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> Error.MoreThanOneMatch();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> current;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>default</span> (TSource);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p>In conclusion ✅ :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>SingleOrDefault&lt;TSource&gt;(<span style=color:#66d9ef>this</span> IEnumerable&lt;TSource&gt; source) <span style=color:#960050;background-color:#1e0010>→</span> O(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>SingleOrDefault&lt;TSource&gt;(
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span> IEnumerable&lt;TSource&gt; source, Func&lt;TSource, <span style=color:#66d9ef>bool</span>&gt; predicate) <span style=color:#960050;background-color:#1e0010>→</span> O(N)
</span></span></code></pre></div><p>Microsoft&rsquo;s CoreFX Repo: <a href=https://github.com/dotnet/corefx/blob/master/src/System.Linq/src/System/Linq/Single.cs>Single.cs</a></p></div><hr><div class=footer><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script type=text/javascript>hljs.configure({languages:[]}),hljs.initHighlightingOnLoad()</script><h2>Comments</h2><div id=disqus_thread></div><script type=text/javascript>(function(){if(location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="moientajik",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></body></html>